@startuml "Diagramme de classes MVC - Système d'évaluation"

skinparam packageStyle rectangle
skinparam classAttributeIconSize 0
skinparam shadowing false
skinparam defaultFontSize 10
skinparam class {
  BackgroundColor<<Vue>> #E3F2FD
  BorderColor<<Vue>> #1976D2
  BackgroundColor<<Controleur>> #FFF9C4
  BorderColor<<Controleur>> #F57F17
  BackgroundColor<<Modele>> #E8F5E9
  BorderColor<<Modele>> #388E3C
  BackgroundColor<<Service>> #FFE0B2
  BorderColor<<Service>> #E65100
  BackgroundColor<<Entity>> #F5F5F5
  BorderColor<<Entity>> #616161
}

title Diagramme de classes MVC\nUC1 : Remplir une évaluation | UC6 : Visualiser le tableau de bord

'═══════════════════════════════════════════════════════════════
' PACKAGE VUE (PRÉSENTATION)
'═══════════════════════════════════════════════════════════════

package "Vue (Présentation)" <<Vue>> {
  
  package "UC1 - Évaluation" {
    class PageEvaluation <<Vue>> {
      - idUtilisateur : int
      - formulaireActuel : Formulaire
      --
      + afficherFormulaire(formulaire : Formulaire) : void
      + afficherConfirmation(message : String) : void
      + afficherErreurs(erreurs : List<String>) : void
      + afficherBrouillon(donnees : JSON) : void
      + validerSaisie() : boolean
    }

    class FormulaireMobile <<Vue>> {
      - modeHorsLigne : boolean
      - donneesLocales : JSON
      --
      + saisirReponses() : void
      + sauvegarderBrouillon() : void
      + synchroniser() : void
      + optimiserAffichage() : void
    }
  }

  package "UC6 - Tableau de bord" {
    class TableauBord <<Vue>> {
      - idUtilisateur : int
      - role : String
      - filtresActifs : List<Filtre>
      --
      + afficherStatistiques(stats : Statistiques) : void
      + afficherGraphiques(donnees : JSON) : void
      + appliquerFiltre(filtre : Filtre) : void
      + exporterDonnees(format : String) : void
    }

    class GraphiquesInteractifs <<Vue>> {
      - typeGraphique : String
      - donneesAffichees : JSON
      --
      + afficherStatistiquesGlobales(stats : Statistiques) : void
      + afficherGraphiqueEvolution(evolution : Evolution) : void
      + afficherGraphiqueCategoriesPie(categories : List) : void
      + actualiserGraphiques(donnees : JSON) : void
      + genererGraphiqueComparaison(comparaison : Comparaison) : void
    }

    class VueMobile <<Vue>> {
      - modeLeger : boolean
      --
      + afficherVueSimplifiee(stats : Statistiques) : void
      + chargerDetailsComplets() : void
    }
  }
}

'═══════════════════════════════════════════════════════════════
' PACKAGE CONTRÔLEUR (MÉTIER)
'═══════════════════════════════════════════════════════════════

package "Contrôleur (Métier)" <<Controleur>> {
  
  package "UC1 - Contrôleurs" {
    class EvaluationController <<Controleur>> {
      - evaluationModel : EvaluationModel
      - questionModel : QuestionModel
      - reponsesModel : ReponsesModel
      - anonymatService : AnonymatService
      - notificationService : NotificationService
      --
      + demanderFormulaireEvaluation(idEnseignant : int, idCours : int) : Formulaire
      + soumettreEvaluation(donnees : DonneesEvaluation) : ResultatSoumission
      + validerCompletude(donnees : DonneesEvaluation) : ValidationResult
      + sauvegarderBrouillon(donnees : DonneesEvaluation) : boolean
      + recupererBrouillon(idEtudiant : int, idEvaluation : int) : Brouillon
      - assemblerFormulaire(formulaire : Formulaire, questions : List) : FormulaireComplet
    }
  }

  package "UC6 - Contrôleurs" {
    class TableauBordController <<Controleur>> {
      - evaluationModel : EvaluationModel
      - statsModel : StatistiquesModel
      - commentModel : CommentairesModel
      - statsService : StatistiquesService
      - evolutionService : EvolutionService
      - filtreService : FiltreService
      --
      + chargerTableauBord(idUtilisateur : int, role : String) : TableauBordData
      + chargerTableauBordMobile(idUtilisateur : int, mode : String) : TableauBordData
      + appliquerFiltre(typeFiltrage : String, valeurs : JSON) : DonneesFiltrees
      + demanderComparaison(idEnseignant : int) : Comparaison
      + chargerDetailsComplets(idUtilisateur : int) : DonneesCompletes
      - verifierPermissions(idUtilisateur : int, role : String) : boolean
      - assemblerTableauBord(stats : Statistiques, evolution : Evolution, commentaires : List) : TableauBordData
    }
  }
}

'═══════════════════════════════════════════════════════════════
' PACKAGE MODÈLE (DONNÉES)
'═══════════════════════════════════════════════════════════════

package "Modèle (Données)" <<Modele>> {
  
  package "UC1 - Modèles" {
    class EvaluationModel <<Modele>> {
      - connexionBDD : Connection
      --
      + recupererFormulaireActif(idCours : int) : Formulaire
      + recupererEvaluations(idUtilisateur : int, periode : DateRange) : List<Evaluation>
      + recupererStatistiquesResumees(idUtilisateur : int) : StatistiquesResumees
    }

    class QuestionModel <<Modele>> {
      - connexionBDD : Connection
      --
      + recupererQuestions(idFormulaire : int) : List<Question>
      + recupererQuestionsParCategorie(categorie : String) : List<Question>
    }

    class ReponsesModel <<Modele>> {
      - connexionBDD : Connection
      --
      + enregistrerEvaluation(donnees : DonneesEvaluation) : int
      + enregistrerBrouillon(idEtudiant : int, donnees : JSON) : boolean
      + chargerBrouillon(idEtudiant : int, idEvaluation : int) : Brouillon
      + supprimerBrouillon(idBrouillon : int) : boolean
    }
  }

  package "UC6 - Modèles" {
    class StatistiquesModel <<Modele>> {
      - connexionBDD : Connection
      --
      + calculerMoyennes(evaluations : List<Evaluation>) : Moyennes
      + recupererDonneesTemporelles(idUtilisateur : int, periode : DateRange) : List<DonneeTemporelle>
      + recupererMoyenneGlobale(departement : int) : double
      + calculerStatistiquesParCategorie(evaluations : List) : Map
    }

    class CommentairesModel <<Modele>> {
      - connexionBDD : Connection
      --
      + recupererCommentairesRecents(idUtilisateur : int, limite : int) : List<Commentaire>
      + recupererTousCommentaires(idUtilisateur : int) : List<Commentaire>
      + analyserSentiments(commentaires : List<Commentaire>) : AnalyseSentiment
    }
  }
}

'═══════════════════════════════════════════════════════════════
' PACKAGE SERVICES (LOGIQUE MÉTIER TRANSVERSALE)
'═══════════════════════════════════════════════════════════════

package "Services (Logique métier transversale)" <<Service>> {
  
  class AnonymatService <<Service>> {
    - niveauAnonymat : String
    --
    + garantirAnonymat(donnees : DonneesEvaluation) : DonneesAnonymisees
    + anonymiserDonnees(donnees : JSON) : JSON
    + verifierConfigurationAnonymat() : ConfigAnonymat
    - supprimerMetadonnees(donnees : JSON) : JSON
  }

  class NotificationService <<Service>> {
    - systemNotification : SystemNotification
    --
    + envoyerNotification(typeEvent : String, destinataire : String) : boolean
    + enregistrerEvenement(event : Event) : void
    + planifierNotification(date : DateTime, message : String) : void
  }

  class StatistiquesService <<Service>> {
    - statsModel : StatistiquesModel
    --
    + calculerStatistiquesGlobales(evaluations : List<Evaluation>) : Statistiques
    + calculerIndicateurs(evaluations : List) : Indicateurs
    + calculerMoyenneDepartement(departement : int) : double
    + calculerPositionnement(moyenne : double, moyenneGlobale : double) : Positionnement
    + recalculerStatistiques(donnees : List) : Statistiques
  }

  class EvolutionService <<Service>> {
    - statsModel : StatistiquesModel
    --
    + recupererEvolution(idUtilisateur : int, periode : DateRange) : Evolution
    + calculerTendances(donneesTemporelles : List) : Tendances
    + detecterAnomalies(evolution : Evolution) : List<Anomalie>
    + genererProjection(historique : List) : Projection
  }

  class FiltreService <<Service>> {
    --
    + filtrerDonnees(criteres : Map) : List<Evaluation>
    + appliquerFiltreTemporel(periode : DateRange, donnees : List) : List
    + appliquerFiltreCategorie(categorie : String, donnees : List) : List
    + construireRequeteFiltre(criteres : Map) : String
  }
}

'═══════════════════════════════════════════════════════════════
' ENTITÉS (OBJETS MÉTIER)
'═══════════════════════════════════════════════════════════════

package "Entités (Objets métier)" <<Entity>> {
  
  class Evaluation <<Entity>> {
    - idEvaluation : int
    - idEtudiant : int
    - idEnseignant : int
    - idCours : int
    - idFormulaire : int
    - dateCreation : DateTime
    - dateSoumission : DateTime
    - statut : String
    - noteGlobale : double
    --
    + calculerNoteGlobale() : double
    + estComplete() : boolean
    + toJSON() : String
  }

  class Formulaire <<Entity>> {
    - idFormulaire : int
    - titre : String
    - description : String
    - actif : boolean
    - dateCreation : DateTime
    --
    + ajouterQuestion(question : Question) : void
    + supprimerQuestion(idQuestion : int) : void
    + estActif() : boolean
  }

  class Question <<Entity>> {
    - idQuestion : int
    - idFormulaire : int
    - libelle : String
    - type : String
    - obligatoire : boolean
    - categorie : String
    - ordre : int
    - optionsReponse : List<String>
    --
    + validerReponse(reponse : String) : boolean
    + estObligatoire() : boolean
  }

  class Reponse <<Entity>> {
    - idReponse : int
    - idEvaluation : int
    - idQuestion : int
    - valeur : String
    - note : int
    - dateReponse : DateTime
    --
    + getValeurNumerique() : int
    + toJSON() : String
  }

  class Brouillon <<Entity>> {
    - idBrouillon : int
    - idEtudiant : int
    - idFormulaire : int
    - donneesJSON : String
    - dateSauvegarde : DateTime
    - pourcentageCompletion : int
    --
    + calculerCompletion() : int
    + restaurerDonnees() : JSON
    + fusionnerAvecNouvellesDonnees(nouvelles : JSON) : void
  }

  class Statistiques <<Entity>> {
    - idStatistique : int
    - idEnseignant : int
    - moyenneGlobale : double
    - nombreEvaluations : int
    - tauxParticipation : double
    - tauxSatisfaction : double
    - moyennesParCategorie : Map<String, Double>
    - periode : DateRange
    --
    + calculerEcartType() : double
    + comparerAvec(autreStats : Statistiques) : Comparaison
    + toJSON() : String
  }

  class Commentaire <<Entity>> {
    - idCommentaire : int
    - idEvaluation : int
    - contenu : String
    - dateCreation : DateTime
    - sentiment : String
    - categorie : String
    --
    + estPositif() : boolean
    + extraireMots-cles() : List<String>
  }

  class Evolution <<Entity>> {
    - idEvolution : int
    - idUtilisateur : int
    - donneesTemporelles : List<PointTemporel>
    - tendance : String
    - tauxProgression : double
    --
    + calculerTendance() : String
    + obtenirDerniereValeur() : double
    + obtenirVariation() : double
  }

  class Utilisateur <<Entity>> {
    - idUtilisateur : int
    - nom : String
    - prenom : String
    - email : String
    - role : String
    - actif : boolean
    --
    + estEnseignant() : boolean
    + estAdministrateur() : boolean
    + estEtudiant() : boolean
  }
}

'═══════════════════════════════════════════════════════════════
' RELATIONS VUE → CONTRÔLEUR
'═══════════════════════════════════════════════════════════════

PageEvaluation --> EvaluationController : utilise
FormulaireMobile --> EvaluationController : utilise

TableauBord --> TableauBordController : utilise
GraphiquesInteractifs --> TableauBordController : utilise
VueMobile --> TableauBordController : utilise

'═══════════════════════════════════════════════════════════════
' RELATIONS CONTRÔLEUR → MODÈLE
'═══════════════════════════════════════════════════════════════

EvaluationController --> EvaluationModel : utilise
EvaluationController --> QuestionModel : utilise
EvaluationController --> ReponsesModel : utilise

TableauBordController --> EvaluationModel : utilise
TableauBordController --> StatistiquesModel : utilise
TableauBordController --> CommentairesModel : utilise

'═══════════════════════════════════════════════════════════════
' RELATIONS CONTRÔLEUR → SERVICES
'═══════════════════════════════════════════════════════════════

EvaluationController --> AnonymatService : utilise
EvaluationController --> NotificationService : utilise

TableauBordController --> StatistiquesService : utilise
TableauBordController --> EvolutionService : utilise
TableauBordController --> FiltreService : utilise

'═══════════════════════════════════════════════════════════════
' RELATIONS SERVICES → MODÈLES
'═══════════════════════════════════════════════════════════════

StatistiquesService --> StatistiquesModel : utilise
EvolutionService --> StatistiquesModel : utilise
FiltreService --> EvaluationModel : utilise

'═══════════════════════════════════════════════════════════════
' RELATIONS MODÈLE → ENTITÉS
'═══════════════════════════════════════════════════════════════

EvaluationModel --> Evaluation : gère
EvaluationModel --> Formulaire : gère
QuestionModel --> Question : gère
ReponsesModel --> Reponse : gère
ReponsesModel --> Brouillon : gère

StatistiquesModel --> Statistiques : gère
StatistiquesModel --> Evolution : gère
CommentairesModel --> Commentaire : gère

'═══════════════════════════════════════════════════════════════
' RELATIONS ENTRE ENTITÉS (ASSOCIATIONS)
'═══════════════════════════════════════════════════════════════

Utilisateur "1" -- "*" Evaluation : effectue
Formulaire "1" *-- "*" Question : contient
Evaluation "1" *-- "*" Reponse : contient
Question "1" -- "*" Reponse : répond à
Evaluation "1" -- "*" Commentaire : contient
Utilisateur "1" -- "*" Brouillon : sauvegarde
Utilisateur "1" -- "0..1" Statistiques : possède
Utilisateur "1" -- "0..1" Evolution : suit

'═══════════════════════════════════════════════════════════════
' NOTES EXPLICATIVES
'═══════════════════════════════════════════════════════════════

note right of EvaluationController
  <b>Contrôleur principal UC1</b>
  ─────────────────────
  Orchestre le processus d'évaluation
  depuis la récupération du formulaire
  jusqu'à la soumission finale
end note

note right of TableauBordController
  <b>Contrôleur principal UC6</b>
  ─────────────────────
  Gère l'affichage du tableau de bord,
  les filtres et les statistiques
end note

note bottom of AnonymatService
  <b>Service transversal</b>
  ─────────────────────
  Garantit l'anonymat configuré
  par l'administrateur
end note

note bottom of StatistiquesService
  <b>Service de calculs</b>
  ─────────────────────
  Effectue tous les calculs statistiques
  et agrégations de données
end note

@enduml
